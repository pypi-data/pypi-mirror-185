Metadata-Version: 2.1
Name: DrissionPage
Version: 3.0.34
Summary: A module that integrates selenium and requests session, encapsulates common page operations.
Home-page: https://gitee.com/g1879/DrissionPage
Author: g1879
Author-email: g1879@qq.com
License: BSD
Keywords: DrissionPage
Classifier: Programming Language :: Python :: 3.6
Classifier: Development Status :: 4 - Beta
Classifier: Topic :: Utilities
Classifier: License :: OSI Approved :: BSD License
Requires-Python: >=3.6
Description-Content-Type: text/markdown
License-File: LICENSE
Requires-Dist: selenium
Requires-Dist: lxml
Requires-Dist: tldextract
Requires-Dist: requests
Requires-Dist: DownloadKit
Requires-Dist: FlowViewer
Requires-Dist: websocket-client

DrissionPage æ˜¯ä¸€ä¸ªåŸºäº python çš„ç½‘é¡µè‡ªåŠ¨åŒ–å·¥å…·ã€‚

å®ƒæ—¢èƒ½æ§åˆ¶æµè§ˆå™¨ï¼Œä¹Ÿèƒ½æ”¶å‘æ•°æ®åŒ…ï¼Œç”šè‡³èƒ½æŠŠä¸¤è€…åˆè€Œä¸ºä¸€ï¼Œ

å¯å…¼é¡¾æµè§ˆå™¨è‡ªåŠ¨åŒ–çš„ä¾¿åˆ©æ€§å’Œ requests çš„é«˜æ•ˆç‡ã€‚

å®ƒåŠŸèƒ½å¼ºå¤§ï¼Œå†…ç½®æ— æ•°äººæ€§åŒ–è®¾è®¡å’Œä¾¿æ·åŠŸèƒ½ã€‚

å®ƒçš„è¯­æ³•ç®€æ´è€Œä¼˜é›…ï¼Œä»£ç é‡å°‘ï¼Œå¯¹æ–°æ‰‹å‹å¥½ã€‚

***

æ”¯æŒç³»ç»Ÿï¼šWindowsã€Linuxã€Mac

python ç‰ˆæœ¬ï¼š3.6 åŠä»¥ä¸Š

æ”¯æŒæµè§ˆå™¨ï¼šChromium å†…æ ¸æµè§ˆå™¨ï¼ˆå¦‚ Chrome å’Œ edgeï¼‰

*** 

<a href='https://gitee.com/g1879/DrissionPage/stargazers'><img src='https://gitee.com/g1879/DrissionPage/badge/star.svg?theme=dark' alt='star'></img></a> <a href='https://gitee.com/g1879/DrissionPage/members'><img src='https://gitee.com/g1879/DrissionPage/badge/fork.svg?theme=dark' alt='fork'></img></a>

é¡¹ç›®åœ°å€ï¼š[gitee](https://gitee.com/g1879/DrissionPage)    |    [github](https://github.com/g1879/DrissionPage)

**äº¤æµQQç¾¤ï¼š**  897838127

**è”ç³»é‚®ç®±ï¼š**  g1879@qq.com

# ğŸ“• èƒŒæ™¯

ç”¨ requests åšæ•°æ®é‡‡é›†é¢å¯¹è¦ç™»å½•çš„ç½‘ç«™æ—¶ï¼Œè¦åˆ†ææ•°æ®åŒ…ã€JS æºç ï¼Œæ„é€ å¤æ‚çš„è¯·æ±‚ï¼Œå¾€å¾€è¿˜è¦åº”ä»˜éªŒè¯ç ã€JS æ··æ·†ã€ç­¾åå‚æ•°ç­‰åçˆ¬æ‰‹æ®µï¼Œé—¨æ§›è¾ƒé«˜ã€‚è‹¥æ•°æ®æ˜¯ç”± JS è®¡ç®—ç”Ÿæˆçš„ï¼Œè¿˜é¡»é‡ç°è®¡ç®—è¿‡ç¨‹ï¼Œä½“éªŒä¸å¥½ï¼Œå¼€å‘æ•ˆç‡ä¸é«˜ã€‚
ä½¿ç”¨æµè§ˆå™¨ï¼Œå¯ä»¥å¾ˆå¤§ç¨‹åº¦ä¸Šç»•è¿‡è¿™äº›å‘ï¼Œä½†æµè§ˆå™¨è¿è¡Œæ•ˆç‡ä¸é«˜ã€‚

å› æ­¤ï¼Œè¿™ä¸ªåº“è®¾è®¡åˆè¡·ï¼Œæ˜¯å°†å®ƒä»¬åˆè€Œä¸ºä¸€ï¼Œèƒ½å¤Ÿåœ¨ä¸åŒé¡»è¦æ—¶åˆ‡æ¢ç›¸åº”æ¨¡å¼ï¼Œå¹¶æä¾›ä¸€ç§äººæ€§åŒ–çš„ä½¿ç”¨æ–¹æ³•ï¼Œæé«˜å¼€å‘å’Œè¿è¡Œæ•ˆç‡ã€‚  
é™¤äº†åˆå¹¶ä¸¤è€…ï¼Œæœ¬åº“è¿˜ä»¥ç½‘é¡µä¸ºå•ä½å°è£…äº†å¸¸ç”¨åŠŸèƒ½ï¼Œæä¾›éå¸¸ç®€ä¾¿çš„æ“ä½œå’Œè¯­å¥ï¼Œåœ¨ç”¨äºç½‘é¡µè‡ªåŠ¨åŒ–æ“ä½œæ—¶ï¼Œå‡å°‘è€ƒè™‘ç»†èŠ‚ï¼Œä¸“æ³¨åŠŸèƒ½å®ç°ï¼Œä½¿ç”¨æ›´æ–¹ä¾¿ã€‚  ä¸€åˆ‡ä»ç®€ï¼Œå°½é‡æä¾›ç®€å•ç›´æ¥çš„ä½¿ç”¨æ–¹æ³•ï¼Œä½¿ä»£ç æ›´ä¼˜é›…ã€‚

ä»¥å‰çš„ç‰ˆæœ¬æ˜¯å¯¹ selenium è¿›è¡Œé‡æ–°å°è£…å®ç°çš„ã€‚ä» 3.0 å¼€å§‹ï¼Œä½œè€…å¦èµ·ç‚‰ç¶ï¼Œå¯¹åº•å±‚è¿›è¡Œäº†é‡æ–°å¼€å‘ï¼Œæ‘†è„±å¯¹ selenium çš„ä¾èµ–ï¼Œå¢å¼ºäº†åŠŸèƒ½ï¼Œæå‡äº†è¿è¡Œæ•ˆç‡ã€‚

# ğŸ’¡ ç†å¿µ

ç®€æ´ï¼æ˜“ç”¨ ï¼æ–¹ä¾¿ï¼

# â˜€ï¸ ç‰¹æ€§å’Œäº®ç‚¹

ä½œè€…ç»è¿‡é•¿æœŸå®è·µï¼Œè¸©è¿‡æ— æ•°å‘ï¼Œæ€»ç»“å‡ºçš„ç»éªŒå…¨å†™åˆ°è¿™ä¸ªåº“é‡Œäº†ã€‚

## ğŸ‡ å¼ºå¤§çš„è‡ªç ”å†…æ ¸

æœ¬åº“é‡‡ç”¨å…¨è‡ªç ”çš„å†…æ ¸ï¼Œå†…ç½®äº† N å¤šå®ç”¨åŠŸèƒ½ï¼Œå¯¹å¸¸ç”¨åŠŸèƒ½ä½œäº†æ•´åˆå’Œä¼˜åŒ–ï¼Œå¯¹æ¯” seleniumï¼Œæœ‰ä»¥ä¸‹ä¼˜ç‚¹ï¼š

- æ—  webdriver ç‰¹å¾ï¼Œä¸ä¼šè¢«ç½‘ç«™è¯†åˆ«

- æ— éœ€ä¸ºä¸åŒç‰ˆæœ¬çš„æµè§ˆå™¨ä¸‹è½½ä¸åŒçš„é©±åŠ¨

- è¿è¡Œé€Ÿåº¦æ›´å¿«

- å¯ä»¥è·¨ iframe æŸ¥æ‰¾å…ƒç´ ï¼Œæ— éœ€åˆ‡å…¥åˆ‡å‡º

- æŠŠ iframe çœ‹ä½œæ™®é€šå…ƒç´ ï¼Œè·å–åå¯ç›´æ¥åœ¨å…¶ä¸­æŸ¥æ‰¾å…ƒç´ ï¼Œé€»è¾‘æ›´æ¸…æ™°

- å¯ä»¥åŒæ—¶æ“ä½œæµè§ˆå™¨ä¸­çš„å¤šä¸ªæ ‡ç­¾é¡µï¼Œå³ä½¿æ ‡ç­¾é¡µä¸ºéæ¿€æ´»çŠ¶æ€ï¼Œæ— éœ€åˆ‡æ¢

- å¯ä»¥ç›´æ¥è¯»å–æµè§ˆå™¨ç¼“å­˜æ¥ä¿å­˜å›¾ç‰‡ï¼Œæ— éœ€ç”¨ GUI ç‚¹å‡»å¦å­˜

- å¯ä»¥å¯¹æ•´ä¸ªç½‘é¡µæˆªå›¾ï¼ŒåŒ…æ‹¬è§†å£å¤–çš„éƒ¨åˆ†ï¼ˆ90ä»¥ä¸Šç‰ˆæœ¬æµè§ˆå™¨æ”¯æŒï¼‰

## ğŸ‡ äº®ç‚¹åŠŸèƒ½

é™¤äº†ä»¥ä¸Šä¼˜ç‚¹ï¼Œæœ¬åº“è¿˜å†…ç½®äº†æ— æ•°äººæ€§åŒ–è®¾è®¡ã€‚

- æç®€çš„è¯­æ³•è§„åˆ™ã€‚é›†æˆå¤§é‡å¸¸ç”¨åŠŸèƒ½ï¼Œä»£ç æ›´ä¼˜é›…

- å®šä½å…ƒç´ æ›´åŠ å®¹æ˜“ï¼ŒåŠŸèƒ½æ›´å¼ºå¤§ç¨³å®š

- æ— å¤„ä¸åœ¨çš„ç­‰å¾…å’Œè‡ªåŠ¨é‡è¯•åŠŸèƒ½ã€‚ä½¿ä¸ç¨³å®šçš„ç½‘ç»œå˜å¾—æ˜“äºæ§åˆ¶ï¼Œç¨‹åºæ›´ç¨³å®šï¼Œç¼–å†™æ›´çœå¿ƒ

- æä¾›å¼ºå¤§çš„ä¸‹è½½å·¥å…·ã€‚æ“ä½œæµè§ˆå™¨æ—¶ä¹Ÿèƒ½äº«å—å¿«æ·å¯é çš„ä¸‹è½½åŠŸèƒ½

- å…è®¸åå¤ä½¿ç”¨å·²ç»æ‰“å¼€çš„æµè§ˆå™¨ã€‚æ— é¡»æ¯æ¬¡è¿è¡Œä»å¤´å¯åŠ¨æµè§ˆå™¨ï¼Œè°ƒè¯•è¶…æ–¹ä¾¿

- ä½¿ç”¨ ini æ–‡ä»¶ä¿å­˜å¸¸ç”¨é…ç½®ï¼Œè‡ªåŠ¨è°ƒç”¨ï¼Œæä¾›ä¾¿æ·çš„è®¾ç½®ï¼Œè¿œç¦»ç¹æ‚çš„é…ç½®é¡¹

- å†…ç½® lxml ä½œä¸ºè§£æå¼•æ“ï¼Œè§£æé€Ÿåº¦æˆå‡ ä¸ªæ•°é‡çº§æå‡

- ä½¿ç”¨ POM æ¨¡å¼å°è£…ï¼Œå¯ç›´æ¥ç”¨äºæµ‹è¯•ï¼Œä¾¿äºæ‰©å±•

- é«˜åº¦é›†æˆçš„ä¾¿åˆ©åŠŸèƒ½ï¼Œä»æ¯ä¸ªç»†èŠ‚ä¸­ä½“ç°

- è¿˜æœ‰å¾ˆå¤šç»†èŠ‚ï¼Œè¿™é‡Œä¸ä¸€ä¸€åˆ—ä¸¾ï¼Œæ¬¢è¿å®é™…ä½¿ç”¨ä¸­ä½“éªŒï¼šï¼‰

# ğŸŒŸ ç®€å•æ¼”ç¤º

## â­ **ä¸ selenium ä»£ç å¯¹æ¯”**

ä»¥ä¸‹ä»£ç å®ç°ä¸€æ¨¡ä¸€æ ·çš„åŠŸèƒ½ï¼Œå¯¹æ¯”ä¸¤è€…çš„ä»£ç é‡ï¼š

âœ¨ï¸ ç”¨æ˜¾æ€§ç­‰å¾…æ–¹å¼å®šä½ç¬¬ä¸€ä¸ªæ–‡æœ¬åŒ…å«`some text`çš„å…ƒç´ 

```python
# ä½¿ç”¨ seleniumï¼š
element = WebDriverWait(driver).until(ec.presence_of_element_located((By.XPATH, '//*[contains(text(), "some text")]')))

# ä½¿ç”¨ DrissionPageï¼š
element = page('some text')
```

âœ¨ï¸ è·³è½¬åˆ°ç¬¬ä¸€ä¸ªæ ‡ç­¾é¡µ

```python
# ä½¿ç”¨ seleniumï¼š
driver.switch_to.window(driver.window_handles[0])

# ä½¿ç”¨ DrissionPageï¼š
page.to_tab(page.tabs[0])
```

âœ¨ï¸ æŒ‰æ–‡æœ¬é€‰æ‹©ä¸‹æ‹‰åˆ—è¡¨

```python
# ä½¿ç”¨ seleniumï¼š
from selenium.webdriver.support.select import Select

select_element = Select(element)
select_element.select_by_visible_text('text')

# ä½¿ç”¨ DrissionPageï¼š
element.select('text')
```

âœ¨ï¸ æ‹–æ‹½ä¸€ä¸ªå…ƒç´ 

```python
# ä½¿ç”¨ seleniumï¼š
ActionChains(driver).drag_and_drop(ele1, ele2).perform()

# ä½¿ç”¨ DrissionPageï¼š
ele1.drag_to(ele2)
```

âœ¨ï¸ æ»šåŠ¨çª—å£åˆ°åº•éƒ¨ï¼ˆä¿æŒæ°´å¹³æ»šåŠ¨æ¡ä¸å˜ï¼‰

```python
# ä½¿ç”¨ seleniumï¼š
driver.execute_script("window.scrollTo(document.documentElement.scrollLeft, document.body.scrollHeight);")

# ä½¿ç”¨ DrissionPageï¼š
page.scroll.to_bottom()
```

âœ¨ï¸ è·å–ä¼ªå…ƒç´ å†…å®¹

```python
# ä½¿ç”¨ seleniumï¼š
text = webdriver.execute_script('return window.getComputedStyle(arguments[0], "::after").getPropertyValue("content");',
                                element)

# ä½¿ç”¨ DrissionPageï¼š
text = element.pseudo_after
```

âœ¨ï¸ shadow-root æ“ä½œ

```python
# ä½¿ç”¨ seleniumï¼š
shadow_element = webdriver.execute_script('return arguments[0].shadowRoot', element)

# ä½¿ç”¨ DrissionPageï¼š
shadow_element = element.sr

# åœ¨ shadow_root ä¸‹å¯ç»§ç»­æ‰§è¡ŒæŸ¥æ‰¾ï¼Œè·å–æ™®é€šå…ƒç´ 
ele = shadow_element.ele('tag:div')
ele.click()
```

âœ¨ï¸ éšæ—¶è®©æµè§ˆå™¨çª—å£æ¶ˆå¤±å’Œæ˜¾ç¤ºï¼ˆWindowsç³»ç»Ÿï¼‰

```python
# selenium æ— æ­¤åŠŸèƒ½

# ä½¿ç”¨ DrissionPage
page.hide_browser()  # è®©æµè§ˆå™¨çª—å£æ¶ˆå¤±
page.show_browser()  # é‡æ–°æ˜¾ç¤ºæµè§ˆå™¨çª—å£
```

## â­ **ä¸ requests ä»£ç å¯¹æ¯”**

ä»¥ä¸‹ä»£ç å®ç°ä¸€æ¨¡ä¸€æ ·çš„åŠŸèƒ½ï¼Œå¯¹æ¯”ä¸¤è€…çš„ä»£ç é‡ï¼š

âœ¨ï¸ è·å–å…ƒç´ å†…å®¹

```python
url = 'https://baike.baidu.com/item/python'

# ä½¿ç”¨ requestsï¼š
from lxml import etree

headers = {'User-Agent': 'Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/41.0.2272.118 Safari/537.36'}
response = requests.get(url, headers=headers)
html = etree.HTML(response.text)
element = html.xpath('//h1')[0]
title = element.text

# ä½¿ç”¨ DrissionPageï¼š
page = WebPage('s')
page.get(url)
title = page('tag:h1').text
```

Tips: DrissionPage è‡ªå¸¦é»˜è®¤`headers`

âœ¨ï¸ ä¸‹è½½æ–‡ä»¶

```python
url = 'https://www.baidu.com/img/flexible/logo/pc/result.png'
save_path = r'C:\download'

# ä½¿ç”¨ requestsï¼š
r = requests.get(url)
with open(f'{save_path}\\img.png', 'wb') as fd:
   for chunk in r.iter_content():
       fd.write(chunk)

# ä½¿ç”¨ DrissionPageï¼š
page.download(url, save_path, 'img')  # æ”¯æŒé‡å‘½åï¼Œå¤„ç†æ–‡ä»¶åå†²çªï¼Œè‡ªåŠ¨åˆ›å»ºç›®æ ‡æ–‡ä»¶å¤¹
```

## â­ **æ¨¡å¼åˆ‡æ¢**

ç”¨æµè§ˆå™¨ç™»å½•ç½‘ç«™ï¼Œç„¶ååˆ‡æ¢åˆ° requests è¯»å–ç½‘é¡µã€‚ä¸¤è€…ä¼šå…±äº«ç™»å½•ä¿¡æ¯ã€‚

```python
page = WebPage()  # åˆ›å»ºé¡µé¢å¯¹è±¡ï¼Œé»˜è®¤ driver æ¨¡å¼
page.get('https://gitee.com/profile')  # è®¿é—®ä¸ªäººä¸­å¿ƒé¡µé¢ï¼ˆæœªç™»å½•ï¼Œé‡å®šå‘åˆ°ç™»å½•é¡µé¢ï¼‰

page.ele('@id:user_login').input('your_user_name')  # ä½¿ç”¨ selenium è¾“å…¥è´¦å·å¯†ç ç™»å½•
page.ele('@id:user_password').input('your_password\n')
sleep(1)

page.change_mode()  # åˆ‡æ¢åˆ° session æ¨¡å¼
print('ç™»å½•åtitleï¼š', page.title, '\n')  # ç™»å½•å session æ¨¡å¼çš„è¾“å‡º
```

è¾“å‡ºï¼š

```
ç™»å½•åtitleï¼š ä¸ªäººèµ„æ–™ - ç äº‘ Gitee.com
```

**è·å–å¹¶æ˜¾ç¤ºå…ƒç´ å±æ€§**

```python
# æ¥ä¸Šæ®µä»£ç 
foot = page.ele('@id:footer-left')  # ç”¨ id æŸ¥æ‰¾å…ƒç´ 
first_col = foot.ele('css:>div')  # ä½¿ç”¨ css selector åœ¨å…ƒç´ çš„ä¸‹çº§ä¸­æŸ¥æ‰¾å…ƒç´ ï¼ˆç¬¬ä¸€ä¸ªï¼‰
lnk = first_col.ele('text:å‘½ä»¤å­¦')  # ä½¿ç”¨æ–‡æœ¬å†…å®¹æŸ¥æ‰¾å…ƒç´ 
text = lnk.text  # è·å–å…ƒç´ æ–‡æœ¬
href = lnk.attr('href')  # è·å–å…ƒç´ å±æ€§å€¼

print(text, href, '\n')

# ç®€æ´æ¨¡å¼ä¸²è”æŸ¥æ‰¾
text = page('@id:footer-left')('css:>div')('text:å‘½ä»¤å­¦').text
print(text)
```

è¾“å‡ºï¼š

```
Git å‘½ä»¤å­¦ä¹  https://oschina.gitee.io/learn-git-branching/

Git å‘½ä»¤å­¦ä¹ 
```

# ğŸ›  ä½¿ç”¨æ–¹æ³•

[ç‚¹å‡»è·³è½¬åˆ°ä½¿ç”¨æ–‡æ¡£](http://g1879.gitee.io/drissionpage)

# ğŸ”– ç‰ˆæœ¬å†å²

[ç‚¹å‡»æŸ¥çœ‹ç‰ˆæœ¬å†å²](http://g1879.gitee.io/drissionpage/#/%E7%89%88%E6%9C%AC%E5%8E%86%E5%8F%B2)

# ğŸ–ğŸ» å…è´£å£°æ˜

è¯·å‹¿å°† DrissionPage åº”ç”¨åˆ°ä»»ä½•å¯èƒ½ä¼šè¿åæ³•å¾‹è§„å®šå’Œé“å¾·çº¦æŸçš„å·¥ä½œä¸­,è¯·å‹å–„ä½¿ç”¨ DrissionPageï¼Œéµå®ˆèœ˜è››åè®®ï¼Œä¸è¦å°† DrissionPage ç”¨äºä»»ä½•éæ³•ç”¨é€”ã€‚å¦‚æ‚¨é€‰æ‹©ä½¿ç”¨ DrissionPage
å³ä»£è¡¨æ‚¨éµå®ˆæ­¤åè®®ï¼Œä½œè€…ä¸æ‰¿æ‹…ä»»ä½•ç”±äºæ‚¨è¿åæ­¤åè®®å¸¦æ¥ä»»ä½•çš„æ³•å¾‹é£é™©å’ŒæŸå¤±ï¼Œä¸€åˆ‡åæœç”±æ‚¨æ‰¿æ‹…ã€‚

# â˜• è¯·æˆ‘å–å’–å•¡

å¦‚æœæœ¬é¡¹ç›®å¯¹æ‚¨æœ‰æ‰€å¸®åŠ©ï¼Œä¸å¦¨è¯·ä½œè€…æˆ‘å–æ¯å’–å•¡ ï¼šï¼‰

![](https://gitee.com/g1879/DrissionPage/raw/master/docs/imgs/code.jpg)
