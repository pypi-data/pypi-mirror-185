(this.webpackJsonpweb=this.webpackJsonpweb||[]).push([[0],{447:function(t,e,n){"use strict";n.r(e);var r=n(0),a=n.n(r),i=n(31),c=n(22),o=n(23),s=n(25),u=n(24),l=n(17),d=n(517),j=n(225),h=n(507),p=n(508),b=n(497),f=n(5),O=n(2),v=function(t){var e=t.render,n=t.apiClient,r=t.path;return Object(O.jsx)(l.b,{path:r,render:function(t){return n.hasAuth()?e():Object(O.jsx)(l.a,{to:{pathname:"/login",state:{from:t.location}}})}})},m=n(21),x=n(477),g=n(480),w=n(481),y=n(482),k=n(483),S=n(449),C=n(484),I=n(485),_=n(486),D=n(487),R=n(488),T=n(489),W=n(141),E=n.n(W),N=n(216),A=n.n(N),M=n(217),P=n.n(M),F=function(t){Object(s.a)(n,t);var e=Object(u.a)(n);function n(t){var r;return Object(c.a)(this,n),(r=e.call(this,t)).onReplicate=function(t,e,n){r.props.history.push("/workers/create?module_name=".concat(t,"&args=").concat(encodeURIComponent(JSON.stringify(e)),"&interval_seconds=").concat(n))},r.onRemove=function(t){window.confirm("Are you sure you want to remove worker ".concat(t))&&r.props.apiClient.removeWorker(t).then((function(){r.setState(Object(m.a)(Object(m.a)({},r.state),{},{workers:r.state.workers.filter((function(e){return e.worker_id!==t}))}))})).catch((function(t){r.setState({error:t})}))},r.onUpdateIntervalSeconds=function(t,e){r.props.apiClient.updateWorkerIntervalSeconds(t,e).catch((function(t){r.setState({error:t})}))},r.onUpdateErrorResiliency=function(t,e){r.props.apiClient.updateWorkerErrorResiliency(t,e).catch((function(t){r.setState({error:t})}))},r.state={loading:!0,workers:[]},r}return Object(o.a)(n,[{key:"componentDidMount",value:function(){var t=this;this.props.apiClient.getWorkers().then((function(e){return t.setState({workers:e})})).finally((function(){return t.setState({loading:!1})}))}},{key:"render",value:function(){var t=this;if(this.state.loading)return Object(O.jsx)(x.a,{container:!0,justify:"center",children:Object(O.jsx)(g.a,{})});if(this.state.error)return Object(O.jsx)(x.a,{container:!0,justify:"center",children:Object(O.jsxs)(w.a,{variant:"body1",children:["Failed to load. Reason: ",this.state.error.toString()]})});if(0===this.state.workers.length)return Object(O.jsx)(x.a,{container:!0,justify:"center",children:Object(O.jsx)(y.a,{variant:"contained",color:"primary",onClick:function(e){e.preventDefault(),t.props.history.push("/workers/create")},style:{marginBottom:12},children:"Create new worker"})});var e=Math.floor(Date.now()/1e3);return Object(O.jsxs)("div",{children:[Object(O.jsx)(y.a,{variant:"contained",color:"primary",onClick:function(e){e.preventDefault(),t.props.history.push("/workers/create")},style:{marginBottom:12},children:"Create new worker"}),Object(O.jsx)(k.a,{component:S.a,children:Object(O.jsxs)(C.a,{children:[Object(O.jsx)(I.a,{children:Object(O.jsxs)(_.a,{children:[Object(O.jsx)(D.a,{children:"ID"}),Object(O.jsx)(D.a,{children:"Interval (seconds)"}),Object(O.jsx)(D.a,{children:"Error Resiliency (non-positive is none)"}),Object(O.jsx)(D.a,{children:"Executed minutes ago"}),Object(O.jsx)(D.a,{children:"Operations"})]})}),Object(O.jsx)(R.a,{children:this.state.workers.map((function(n){var r=n.worker_id,a=n.module_name,c=n.args,o=n.interval_seconds,s=n.error_resiliency,u=n.last_executed_seconds;return Object(O.jsxs)(_.a,{children:[Object(O.jsx)(D.a,{children:Object(O.jsx)(i.b,{to:"/worker/".concat(r),children:r})}),Object(O.jsxs)(D.a,{children:[Object(O.jsx)(T.a,{type:"number",value:o,onChange:function(e){e.preventDefault(),t.setState({workers:t.state.workers.map((function(t){return t.worker_id!==r?t:Object(m.a)(Object(m.a)({},t),{},{interval_seconds:parseInt(e.target.value)})}))})}}),Object(O.jsx)(y.a,{onClick:function(e){e.preventDefault(),t.onUpdateIntervalSeconds(r,o)},startIcon:Object(O.jsx)(E.a,{}),color:"secondary",children:"Apply"})]}),Object(O.jsxs)(D.a,{children:[Object(O.jsx)(T.a,{type:"number",value:s,onChange:function(e){e.preventDefault(),t.setState({workers:t.state.workers.map((function(t){return t.worker_id!==r?t:Object(m.a)(Object(m.a)({},t),{},{error_resiliency:parseInt(e.target.value)})}))})}}),Object(O.jsx)(y.a,{onClick:function(e){e.preventDefault(),t.onUpdateErrorResiliency(r,s)},startIcon:Object(O.jsx)(E.a,{}),color:"secondary",children:"Apply"})]}),Object(O.jsx)(D.a,{children:-1!==u?Math.floor((e-u)/60):"N/A"}),Object(O.jsxs)(D.a,{children:[Object(O.jsx)(y.a,{onClick:function(e){e.preventDefault(),t.onReplicate(a,c,o)},startIcon:Object(O.jsx)(A.a,{}),color:"secondary",children:"Duplicate"}),Object(O.jsx)(y.a,{onClick:function(e){e.preventDefault(),t.onRemove(r)},startIcon:Object(O.jsx)(P.a,{}),color:"secondary",children:"Delete"})]})]},r)}))})]})})]})}}]),n}(a.a.Component),B=Object(l.h)(F),L=n(16),U=n(218),J=n.n(U),V=n(490),K=n(491),H=n(514),q=n(510),z=n(516),G=function(t){Object(s.a)(n,t);var e=Object(u.a)(n);function n(t){var r;Object(c.a)(this,n),(r=e.call(this,t)).onSubmit=function(){var t=r.state,e=t.moduleName,n=t.argsString,a=t.intervalSeconds,i=JSON.parse(n);r.props.apiClient.addWorker(e,i,a).then((function(){r.props.history.push("/workers/view")})).catch((function(t){r.setState({error:t})}))},r.moduleArgsToString=function(t){for(var e={},n=0,r=Object.entries(t);n<r.length;n++){var a=Object(L.a)(r[n],2),i=a[0],c=a[1],o=void 0;o="str"===c?"":"int"===c?-1:"bool"!==c&&null,e[i]=o}return JSON.stringify(e,null,4)};var a=J.a.parse(r.props.location.search);return r.state={loading:!0,modules:[],moduleName:a.module_name||"",argsString:a.args||"{}",intervalSeconds:parseInt(a.interval_seconds)||60},r}return Object(o.a)(n,[{key:"componentDidMount",value:function(){var t=this;this.props.apiClient.getWorkerModules().then((function(e){t.setState({modules:e})})).catch((function(e){t.setState({error:e})})).finally((function(){t.setState({loading:!1})}))}},{key:"render",value:function(){var t=this;if(this.state.loading)return Object(O.jsx)(x.a,{container:!0,justify:"center",children:Object(O.jsx)(g.a,{})});if(this.state.error)return Object(O.jsx)(x.a,{container:!0,justify:"center",children:Object(O.jsxs)(w.a,{variant:"body1",children:["Failed to load. Reason: ",this.state.error.toString()]})});var e=!0;try{JSON.parse(this.state.argsString)}catch(n){e=!1}return Object(O.jsxs)(V.a,{children:[Object(O.jsxs)(K.a,{margin:"dense",children:[Object(O.jsx)(H.a,{children:"Module"}),Object(O.jsx)(q.a,{value:this.state.moduleName,onChange:function(e){e.preventDefault();var n=e.target.value,r=t.moduleArgsToString(t.state.modules.filter((function(t){return t.name===n}))[0].args);t.setState({moduleName:n,argsString:r})},children:this.state.modules.map((function(t,e){return Object(O.jsx)(z.a,{value:t.name,children:t.name},e)}))})]}),Object(O.jsxs)(K.a,{margin:"dense",children:[Object(O.jsx)(H.a,{children:"Args"}),Object(O.jsx)(T.a,{value:this.state.argsString,onChange:function(e){e.preventDefault(),t.setState({argsString:e.target.value})},multiline:!0,rows:6,rowsMax:6,error:!e})]}),Object(O.jsxs)(K.a,{margin:"dense",children:[Object(O.jsx)(H.a,{children:"Interval seconds"}),Object(O.jsx)(T.a,{type:"number",value:this.state.intervalSeconds,onChange:function(e){e.preventDefault(),t.setState({intervalSeconds:parseInt(e.target.value)})}})]}),Object(O.jsx)(K.a,{margin:"dense",children:Object(O.jsx)(y.a,{variant:"contained",color:"secondary",onClick:function(e){e.preventDefault(),t.onSubmit()},disabled:!e,children:"Submit"})})]})}}]),n}(a.a.Component),Q=Object(l.h)(G),$=function(t){Object(s.a)(n,t);var e=Object(u.a)(n);function n(t){var r;return Object(c.a)(this,n),(r=e.call(this,t)).state={boards:[],loading:!0},r}return Object(o.a)(n,[{key:"componentDidMount",value:function(){var t=this;this.props.apiClient.getBoards().then((function(e){t.setState({boards:e})})).catch((function(e){t.setState({error:e})})).finally((function(){t.setState({loading:!1})}))}},{key:"render",value:function(){return this.state.loading?Object(O.jsx)(x.a,{container:!0,justify:"center",children:Object(O.jsx)(g.a,{})}):this.state.error?Object(O.jsx)(x.a,{container:!0,justify:"center",children:Object(O.jsxs)(w.a,{variant:"body1",children:["Failed to load. Reason: ",this.state.error.toString()]})}):0===this.state.boards.length?Object(O.jsx)(x.a,{container:!0,justify:"center",children:Object(O.jsx)(w.a,{variant:"body1",children:"No boards"})}):Object(O.jsx)(k.a,{component:S.a,children:Object(O.jsxs)(C.a,{children:[Object(O.jsx)(I.a,{children:Object(O.jsxs)(_.a,{children:[Object(O.jsx)(D.a,{children:"Name"}),Object(O.jsx)(D.a,{children:"Count"}),Object(O.jsx)(D.a,{children:"Query"}),Object(O.jsx)(D.a,{children:"Sort"})]})}),Object(O.jsx)(R.a,{children:this.state.boards.map((function(t,e){for(var n=t.board_id,r=t.board_query,a=r.q,c=r.sort,o=t.count,s=c||{},u="",l=0,d=Object.keys(s);l<d.length;l++){var j=d[l];u+="".concat(j," ").concat(1===s[j]?"\u2191":"\u2193"," ")}return Object(O.jsxs)(_.a,{children:[Object(O.jsx)(D.a,{children:Object(O.jsx)(i.b,{to:"/modView/".concat(encodeURIComponent(n)),children:n})}),Object(O.jsx)(D.a,{children:o}),Object(O.jsx)(D.a,{children:Object(O.jsx)("p",{style:{fontFamily:"monospace"},children:JSON.stringify(a)})}),Object(O.jsx)(D.a,{children:u})]},e)}))})]})})}}]),n}(a.a.Component),X=n(7),Y=n.n(X),Z=n(15),tt=function(t){var e=t.data,n=t.boardId,r=t.callbackId,a=t.rawDocument,i=t.apiClient,c=t.reloading,o=t.reload,s=t.reloadFinished,u=t.getRawDocument,l=t.remove,d=t.rowCount;if(void 0===a&&void 0===u)return Object(O.jsx)("div",{children:"Neither rawDocument nor getRawDocument"});var j=e.text,h=e.after_callback;return Object(O.jsx)(y.a,{variant:"contained",color:"secondary",onClick:function(){var e;e=void 0!==u?u():[a];var j=h;"remove"===j&&1===d&&(j="reload"),"reload"===j?c():"remove"===j&&l(),Promise.all(e.map((function(t){return i.callbackBoard(n,r,t)}))).then((function(t){if("reload"===j){var e=t.map((function(t){return t.data}));o(e[e.length-1])}})).catch(t.onCallbackError).finally((function(){"reload"===j&&s()}))},disabled:t.disabled,children:j})},et=function(t){var e=Object(r.useState)(!1),n=Object(L.a)(e,2),a=n[0],i=n[1];return a?t.fallback:Object(O.jsx)("img",Object(m.a)(Object(m.a)({onError:function(){i(!0)}},t),{},{alt:""}))},nt=function(t){var e=t.data.url;return Object(O.jsx)(et,{src:e,alt:"",style:{objectFit:"contain",width:360,height:480},fallback:Object(O.jsx)("div",{style:{width:360,height:480,textAlign:"center"},children:Object(O.jsx)(w.a,{variant:"body1",children:"This image failed to load"})})})},rt=function(t){var e=t.data;return Object(O.jsx)("div",{children:e.urls.map((function(t){return Object(O.jsx)(nt,{data:{url:t}})}))})},at=n(512),it=n(495),ct=n(496),ot=["twitter.com","mobile.twitter.com","www.twitter.com"],st=function(t){return t.length>50?t.slice(0,50)+"...":t},ut=function(t){var e=t.data.text;e.startsWith('"')&&e.endsWith('"')&&(e=e.substring(1,e.length-1));var n=e;e.startsWith("www.")&&(n="https://".concat(e));var r,a=function(t){try{return new URL(t)}catch(e){return null}}(n);return null!==a?ot.includes(a.hostname)?Object(O.jsx)(y.a,{variant:"contained",color:"secondary",endIcon:Object(O.jsx)(it.a,{}),onClick:function(t){t.preventDefault(),window.open(a.href,"_blank")},children:"Twitter"}):Object(O.jsx)(y.a,{variant:"contained",color:"secondary",endIcon:Object(O.jsx)(ct.a,{}),onClick:function(t){t.preventDefault(),window.open(a.href,"_blank")},children:st((r=a.hostname,r.startsWith("www.")?r.slice(4):r))}):Object(O.jsx)(at.a,{title:e,children:Object(O.jsx)(w.a,{variant:"body1",children:st(e)})})},lt=function(t){var e=Object(r.useState)(!1),n=Object(L.a)(e,2),a=n[0],i=n[1];return a?t.fallback:Object(O.jsx)("video",Object(m.a)({onError:function(){i(!0)}},t))},dt=function(t){var e=t.data.url;return Object(O.jsx)(lt,{controls:!0,style:{objectFit:"contain",width:360,height:480},fallback:Object(O.jsx)("div",{style:{width:360,height:480,textAlign:"center"},children:Object(O.jsx)(w.a,{variant:"body1",children:"This video failed to load"})}),children:Object(O.jsx)("source",{src:e,type:"video/mp4"})})},jt=n(513),ht=function(t){return new Promise((function(e){return setTimeout(e,t)}))},pt=Object(l.h)((function(t){var e=decodeURIComponent(t.match.params.name),n=a.a.useState(!0),i=Object(L.a)(n,2),c=i[0],o=i[1],s=a.a.useState(void 0),u=Object(L.a)(s,2),l=u[0],d=u[1],j=a.a.useState(void 0),h=Object(L.a)(j,2),p=h[0],b=h[1],f=a.a.useState(void 0),v=Object(L.a)(f,2),y=v[0],T=v[1],W=a.a.useState(!1),E=Object(L.a)(W,2),N=E[0],A=E[1];if(Object(r.useEffect)((function(){o(!0),d(void 0),b(void 0),T(void 0),A(!1),t.apiClient.renderBoard(e).then((function(t){return b(t)})).catch((function(t){d(t)})).finally((function(){o(!1)}))}),[t.apiClient,e]),c)return Object(O.jsx)(x.a,{container:!0,justify:"center",children:Object(O.jsx)(g.a,{})});if(l)return Object(O.jsx)(x.a,{container:!0,justify:"center",children:Object(O.jsxs)(w.a,{variant:"body1",children:["Failed to load. Reason: ",l.toString()]})});if(void 0===p)return Object(O.jsx)(x.a,{container:!0,justify:"center",children:Object(O.jsx)(w.a,{variant:"body1",children:"Failed to load. Please retry."})});var M=function(n,r){var a=r.renders;return Object(O.jsx)(_.a,{children:n.map((function(n){var i,c=a[n];return i=c?function(n,r,a,i,c){var s;return"text"===n?s=ut:"image"===n?s=nt:"image_list"===n?s=rt:"button"===n?s=tt:"video"===n&&(s=dt),s?Object(O.jsx)(s,{data:r,boardId:e,callbackId:i,rawDocument:a,getRawDocument:c,apiClient:t.apiClient,reloading:function(){o(!0)},reload:function(t){b(t)},reloadFinished:function(){o(!1)},remove:function(){a&&0!==Object.keys(p).length&&b(Object(m.a)(Object(m.a)({},p),{},{count:p.count-1,payload:p.payload.filter((function(t){return JSON.stringify(t.raw_document)!==JSON.stringify(a)}))}))},rowCount:p.payload.length,onCallbackError:function(){var t=Object(Z.a)(Y.a.mark((function t(e){return Y.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return A(!0),T("Something went wrong while making board callback: ".concat(e.toString(),". Reloading...")),t.next=4,ht(1e3);case 4:window.location.reload();case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),disabled:N}):Object(O.jsx)(w.a,{children:"Unknown column type ".concat(n)})}(c.type,c.data,r.raw_document,c.callback_id):Object(O.jsx)(w.a,{children:"N/A"}),Object(O.jsx)(D.a,{children:i},n)}))},JSON.stringify(r.raw_document))},P=p.payload.length;return Object(O.jsxs)(a.a.Fragment,{children:[Object(O.jsxs)(w.a,{gutterBottom:!0,children:['Mod view "',e,'" (',p.count,p.count!==P?", showing ".concat(P):"",")"]}),function(){var t=p.payload;if(!t||0===t.length)return Object(O.jsx)(w.a,{children:"Query is empty"});var e=p.board_query.projections.map((function(t){return t.name}));return Object(O.jsx)(k.a,{component:S.a,children:Object(O.jsxs)(C.a,{children:[Object(O.jsx)(I.a,{children:Object(O.jsx)(_.a,{children:e.map((function(t){return Object(O.jsx)(D.a,{children:t},t)}))})}),Object(O.jsx)(R.a,{children:t.map((function(t){return M(e,t)}))})]})})}(),Object(O.jsx)(jt.a,{anchorOrigin:{vertical:"bottom",horizontal:"left"},open:void 0!==y,autoHideDuration:1e3,onClose:function(){T(void 0)},message:y})]})})),bt=function(t){Object(s.a)(n,t);var e=Object(u.a)(n);function n(t){var r;return Object(c.a)(this,n),(r=e.call(this,t)).workerId=void 0,r.workerId=r.props.match.params.workerId,r.state={loading:!0,metadataStr:"[]",args:{}},r}return Object(o.a)(n,[{key:"componentDidMount",value:function(){var t=this;Promise.all([this.props.apiClient.getWorkerMetadata(this.workerId),this.props.apiClient.getWorkerArgs(this.workerId)]).then((function(e){var n=Object(L.a)(e,2),r=n[0],a=n[1];t.setState({metadataStr:JSON.stringify(r),args:a})})).catch((function(e){t.setState({error:e})})).finally((function(){t.setState({loading:!1})}))}},{key:"render",value:function(){var t=this,e=!0;try{JSON.parse(this.state.metadataStr)}catch(n){e=!1}return Object(O.jsxs)("div",{children:[Object(O.jsx)(w.a,{children:"Worker ".concat(this.workerId)}),Object(O.jsxs)(V.a,{children:[Object(O.jsxs)(K.a,{margin:"dense",children:[Object(O.jsx)(H.a,{children:"Args"}),Object(O.jsx)(T.a,{multiline:!0,rows:10,rowsMax:10,value:JSON.stringify(this.state.args,null,4),disabled:!0,style:{fontFamily:"monospace"}})]}),Object(O.jsxs)(K.a,{margin:"dense",children:[Object(O.jsx)(H.a,{children:"Metadata"}),Object(O.jsx)(T.a,{multiline:!0,rows:5,rowsMax:5,value:this.state.metadataStr,onChange:function(e){e.preventDefault(),t.setState({metadataStr:e.target.value})},error:!e,style:{fontFamily:"monospace"}})]}),Object(O.jsx)(K.a,{margin:"dense",children:Object(O.jsx)(y.a,{variant:"contained",color:"secondary",onClick:function(e){e.preventDefault(),t.props.apiClient.setWorkerMetadata(t.workerId,JSON.parse(t.state.metadataStr))},disabled:!e,children:"Submit"})})]})]})}}]),n}(a.a.Component),ft=Object(l.h)(bt),Ot=n(118),vt=n.n(Ot),mt=function t(e,n,r){return e.catch(function(){var a=Object(Z.a)(Y.a.mark((function a(i){return Y.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(0!==n){a.next=2;break}throw i;case 2:return console.error(i),console.log("Retrying in ".concat(r,"ms...")),a.next=6,ht(r);case 6:return a.abrupt("return",t(e,n-1,r));case 7:case"end":return a.stop()}}),a)})));return function(t){return a.apply(this,arguments)}}())},xt=function(){function t(){Object(c.a)(this,t),this.TokenLocalStorageKey="accessToken",this.endpoint=void 0,this.axios=void 0,this.isAuth=void 0,Object({NODE_ENV:"production",PUBLIC_URL:"/web",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_ENDPOINT?this.endpoint=Object({NODE_ENV:"production",PUBLIC_URL:"/web",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_ENDPOINT:this.endpoint="",this.axios=vt.a.create(),this.isAuth=!1;var e=localStorage.getItem(this.TokenLocalStorageKey);e&&this.setAuth(e)}return Object(o.a)(t,[{key:"auth",value:function(){var t=Object(Z.a)(Y.a.mark((function t(e,n){var r=this;return Y.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.axios.post("".concat(this.endpoint,"/auth"),{username:e,password:n}).then((function(t){var e=t.data.access_token;if(!e)throw new Error("No access_token in ".concat(t.data));return r.setAuth(e),!0})));case 1:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"setAuth",value:function(t){localStorage.setItem(this.TokenLocalStorageKey,t),this.isAuth=!0,this.axios=vt.a.create({headers:{Authorization:"Bearer "+t}})}},{key:"unsetAuth",value:function(){localStorage.removeItem(this.TokenLocalStorageKey),this.isAuth=!0,this.axios=vt.a.create()}},{key:"hasAuth",value:function(){return this.isAuth}},{key:"getVersion",value:function(){var t=Object(Z.a)(Y.a.mark((function t(){return Y.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.axios.get("".concat(this.endpoint,"/version")).then((function(t){return t.data})));case 1:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"getBoards",value:function(){var t=Object(Z.a)(Y.a.mark((function t(){return Y.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.axios.get("".concat(this.endpoint,"/apiInternal/boards")).then((function(t){return t.data})));case 1:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"renderBoard",value:function(){var t=Object(Z.a)(Y.a.mark((function t(e){return Y.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.axios.get("".concat(this.endpoint,"/apiInternal/boards/render/").concat(e)).then((function(t){return t.data})));case 1:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"callbackBoard",value:function(){var t=Object(Z.a)(Y.a.mark((function t(e,n,r){return Y.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",mt(this.axios.post("".concat(this.endpoint,"/apiInternal/boards/callback/").concat(e,"/").concat(n),r),3,1e3));case 1:case"end":return t.stop()}}),t,this)})));return function(e,n,r){return t.apply(this,arguments)}}()},{key:"getWorkers",value:function(){var t=Object(Z.a)(Y.a.mark((function t(){return Y.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.axios.get("".concat(this.endpoint,"/apiInternal/worker")).then((function(t){return t.data})));case 1:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"getWorkerModules",value:function(){var t=Object(Z.a)(Y.a.mark((function t(){return Y.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.axios.get("".concat(this.endpoint,"/apiInternal/worker/modules")).then((function(t){return t.data})));case 1:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"addWorker",value:function(){var t=Object(Z.a)(Y.a.mark((function t(e,n,r){return Y.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.axios.post("".concat(this.endpoint,"/apiInternal/worker"),{module_name:e,args:n,interval_seconds:r}));case 1:case"end":return t.stop()}}),t,this)})));return function(e,n,r){return t.apply(this,arguments)}}()},{key:"removeWorker",value:function(){var t=Object(Z.a)(Y.a.mark((function t(e){return Y.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.axios.delete("".concat(this.endpoint,"/apiInternal/worker/").concat(e)));case 1:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"updateWorkerIntervalSeconds",value:function(){var t=Object(Z.a)(Y.a.mark((function t(e,n){return Y.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.axios.put("".concat(this.endpoint,"/apiInternal/worker/").concat(e,"/intervalSeconds/").concat(n)));case 1:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"updateWorkerErrorResiliency",value:function(){var t=Object(Z.a)(Y.a.mark((function t(e,n){return Y.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.axios.put("".concat(this.endpoint,"/apiInternal/worker/").concat(e,"/errorResiliency/").concat(n)));case 1:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"getWorkerMetadata",value:function(){var t=Object(Z.a)(Y.a.mark((function t(e){return Y.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.axios.get("".concat(this.endpoint,"/apiInternal/worker/").concat(e,"/metadata")).then((function(t){return t.data})));case 1:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"setWorkerMetadata",value:function(){var t=Object(Z.a)(Y.a.mark((function t(e,n){return Y.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.axios.post("".concat(this.endpoint,"/apiInternal/worker/").concat(e,"/metadata"),n));case 1:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"getWorkerArgs",value:function(){var t=Object(Z.a)(Y.a.mark((function t(e){return Y.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.axios.get("".concat(this.endpoint,"/apiInternal/worker/").concat(e,"/args")).then((function(t){return t.data})));case 1:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"getPipeline",value:function(){var t=Object(Z.a)(Y.a.mark((function t(){return Y.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.axios.get("".concat(this.endpoint,"/apiInternal/pipeline")).then((function(t){return t.data})));case 1:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"getWorkerRuns",value:function(){var t=Object(Z.a)(Y.a.mark((function t(e){return Y.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.axios.get("".concat(this.endpoint,"/apiInternal/worker/runs"),{params:{page:e}}).then((function(t){return t.data})));case 1:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()}]),t}(),gt=n(518),wt=function(t){Object(s.a)(n,t);var e=Object(u.a)(n);function n(t){var r;return Object(c.a)(this,n),(r=e.call(this,t)).login=function(t,e){r.setState({loading:!0,error:void 0}),r.props.apiClient.auth(t,e).then((function(t){t?r.setState({redirectToReferrer:!0}):r.setState({error:"Unauthenticated"})})).catch((function(t){r.setState({error:t.toString()})})).finally((function(){r.setState({loading:!1})}))},r.state={loading:!1,username:"",password:"",redirectToReferrer:!1},r}return Object(o.a)(n,[{key:"render",value:function(){var t=this;if(this.state.redirectToReferrer){var e=(this.props.location.state||{from:{pathname:"/"}}).from;return Object(O.jsx)(l.a,{to:e})}var n=this.props.classes;return Object(O.jsx)(b.a,{component:"main",maxWidth:"xs",children:Object(O.jsx)("div",{className:n.paper,children:Object(O.jsxs)("form",{className:n.form,noValidate:!0,children:[Object(O.jsx)(gt.a,{variant:"outlined",margin:"normal",required:!0,fullWidth:!0,id:"username",label:"Username",name:"username",autoComplete:"username",autoFocus:!0,value:this.state.username,onChange:function(e){e.preventDefault(),t.setState({username:e.target.value})},disabled:this.state.loading}),Object(O.jsx)(gt.a,{variant:"outlined",margin:"normal",required:!0,fullWidth:!0,name:"password",label:"Password",type:"password",id:"password",autoComplete:"current-password",value:this.state.password,onChange:function(e){e.preventDefault(),t.setState({password:e.target.value})},disabled:this.state.loading}),this.state.error?Object(O.jsx)("p",{style:{color:"red"},children:this.state.error}):null,Object(O.jsx)(y.a,{type:"submit",fullWidth:!0,variant:"contained",color:"primary",className:n.submit,onClick:function(e){e.preventDefault(),t.login(t.state.username,t.state.password)},disabled:this.state.loading,children:"Log in"})]})})})}}]),n}(a.a.Component),yt=Object(f.a)((function(t){return Object(d.a)({paper:{marginTop:t.spacing(8),display:"flex",flexDirection:"column",alignItems:"center"},avatar:{margin:t.spacing(1),backgroundColor:t.palette.secondary.main},form:{width:"100%",marginTop:t.spacing(1)},submit:{margin:t.spacing(3,0,2)}})}))(Object(l.h)(wt)),kt=n(143),St=n(78),Ct=n(51),It=n(142),_t=n.n(It),Dt={x:0,y:0},Rt=new _t.a.graphlib.Graph;Rt.setDefaultEdgeLabel((function(){return{}}));var Tt=function(t){var e=Object(r.useState)(!0),n=Object(L.a)(e,2),a=n[0],i=n[1],c=Object(r.useState)(),o=Object(L.a)(c,2),s=o[0],u=o[1],d=Object(l.g)();if(Object(r.useEffect)((function(){Object(Z.a)(Y.a.mark((function e(){var n;return Y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.apiClient.getPipeline();case 2:n=e.sent,u(n),i(!1);case 5:case"end":return e.stop()}}),e)})))()}),[t.apiClient]),a)return Object(O.jsx)(x.a,{container:!0,justify:"center",children:Object(O.jsx)(w.a,{variant:"body1",children:"Loading pipeline..."})});if(!s)return Object(O.jsx)(x.a,{container:!0,justify:"center",children:Object(O.jsx)(w.a,{variant:"body1",children:"No pipeline"})});var j=function(t){return Rt.setGraph({rankdir:"LR"}),t.forEach((function(t){Object(Ct.e)(t)?Rt.setNode(t.id,{width:200,height:50}):Rt.setEdge(t.source,t.target)})),_t.a.layout(Rt),t.map((function(t){if(Object(Ct.e)(t)){var e=Rt.node(t.id);t.targetPosition=Ct.b.Left,t.sourcePosition=Ct.b.Right,t.position={x:e.x-100+Math.random()/1e3,y:e.y-25}}return t}))}(function(t){var e,n=t.pipeline,r=t.sources,a=[{id:"PipelineSources",data:{label:"Sources (".concat(r.length,")"),name:"PipelineSources"},position:Dt}],i=Object(St.a)(n.states);try{for(i.s();!(e=i.n()).done;){var c=e.value;a.push({id:c.name,data:{label:"".concat(c.name," (").concat(c.count,")")},position:Dt})}}catch(O){i.e(O)}finally{i.f()}a.push({id:"PipelineSources-".concat(n.starting_state.name),source:"PipelineSources",target:n.starting_state.name,animated:!0,arrowHeadType:Ct.a.ArrowClosed});var o,s=[].concat(Object(kt.a)(n.workers.map((function(t){return Object(m.a)(Object(m.a)({},t),{},{type:"w"})}))),Object(kt.a)(n.mod_views.map((function(t){return Object(m.a)(Object(m.a)({},t),{},{type:"m"})})))),u=Object(St.a)(s);try{for(u.s();!(o=u.n()).done;){var l,d=o.value,j=d.from_state,h=Object(St.a)(d.to_states);try{for(h.s();!(l=h.n()).done;){var p=l.value,b=d.name,f=d.type;a.push({id:"".concat(j,"-").concat(p),data:{fromState:j,toState:p,name:b,type:f},label:"(".concat(f,") ").concat(b),source:j,target:p,animated:!0,arrowHeadType:Ct.a.ArrowClosed})}}catch(O){h.e(O)}finally{h.f()}}}catch(O){u.e(O)}finally{u.f()}return a}(s));return Object(O.jsx)("div",{style:{height:500,width:1200},children:Object(O.jsx)(Ct.c,{elements:j,nodesDraggable:!1,nodesConnectable:!1,onElementClick:function(t,e){if(Object(Ct.d)(e)&&"m"===e.data.type){var n=e.data;d.push("/modView/".concat(n.name))}}})})},Wt=n(220),Et=n.n(Wt),Nt=n(221),At=n.n(Nt),Mt=n(223),Pt=n.n(Mt),Ft=n(222),Bt=n.n(Ft),Lt=n(498),Ut=n(501),Jt=n(511),Vt=n(502),Kt=36e5,Ht=864e5,qt=function(t){var e=function(t){return t<6e4?"".concat(Math.floor(t/1e3),"s"):t<Kt?"".concat(Math.floor(t/6e4),"m"):t<Ht?"".concat(Math.floor(t/Kt),"h"):t<6048e5&&"".concat(Math.floor(t/Ht),"d")}((new Date).getTime()-t);return e||new Date(t).toISOString().split("T")[0]},zt=n(499),Gt=n(500),Qt=n(503),$t=n(504),Xt=function(t){var e=t.run,n=a.a.useState(!1),r=Object(L.a)(n,2),i=r[0],c=r[1];return Object(O.jsxs)(a.a.Fragment,{children:[Object(O.jsxs)(_.a,{children:[Object(O.jsx)(D.a,{children:e.worker_id}),Object(O.jsx)(D.a,{children:e.run_id}),Object(O.jsx)(D.a,{children:e.state}),Object(O.jsx)(D.a,{children:qt(e.created_ms)}),Object(O.jsx)(D.a,{children:Object(O.jsx)(Lt.a,{"aria-label":"expand row",size:"small",onClick:function(){return c(!i)},children:i?Object(O.jsx)(zt.a,{}):Object(O.jsx)(Gt.a,{})})})]}),Object(O.jsx)(_.a,{children:Object(O.jsx)(D.a,{style:{paddingBottom:0,paddingTop:0},colSpan:6,children:Object(O.jsx)(Ut.a,{in:i,timeout:"auto",unmountOnExit:!0,children:Object(O.jsx)(Jt.a,{margin:1,children:Object(O.jsx)("textarea",{value:e.logs.map((function(t){return"".concat(qt(t.created_ms)," ").concat(t.message)})).join("\n"),disabled:!0,style:{fontFamily:"monospace",resize:"none",width:"100%"}})})})})})]})},Yt=function(t){var e=a.a.useState(!0),n=Object(L.a)(e,2),i=n[0],c=n[1],o=a.a.useState([]),s=Object(L.a)(o,2),u=s[0],l=s[1],d=a.a.useState(1),j=Object(L.a)(d,2),h=j[0],p=j[1];return Object(r.useEffect)((function(){Object(Z.a)(Y.a.mark((function e(){var n;return Y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.apiClient.getWorkerRuns(h);case 2:n=e.sent,l(n),c(!1);case 5:case"end":return e.stop()}}),e)})))()}),[t.apiClient,h]),i?Object(O.jsx)(x.a,{container:!0,justify:"center",children:Object(O.jsx)(w.a,{variant:"body1",children:"Loading worker runs..."})}):0===u.length?Object(O.jsx)(x.a,{container:!0,justify:"center",children:Object(O.jsx)(w.a,{variant:"body1",children:"No worker runs"})}):Object(O.jsx)(k.a,{component:S.a,children:Object(O.jsxs)(C.a,{children:[Object(O.jsx)(I.a,{children:Object(O.jsxs)(_.a,{children:[Object(O.jsx)(D.a,{children:"Worker ID"}),Object(O.jsx)(D.a,{children:"Run ID"}),Object(O.jsx)(D.a,{children:"State"}),Object(O.jsx)(D.a,{children:"Created"}),Object(O.jsx)(D.a,{})]})}),Object(O.jsx)(R.a,{children:u.map((function(t){var e="".concat(t.worker_id,".").concat(t.run_id);return Object(O.jsx)(Xt,{run:t},e)}))}),Object(O.jsx)(Vt.a,{children:Object(O.jsxs)(_.a,{children:[Object(O.jsx)(Lt.a,{onClick:function(){p(h-1)},disabled:1===h,children:Object(O.jsx)(Qt.a,{})}),Object(O.jsx)(Lt.a,{onClick:function(){p(h+1)},disabled:0===u.length,children:Object(O.jsx)($t.a,{})})]})})]})})},Zt=n(505),te=n(506),ee=function(t){Object(s.a)(n,t);var e=Object(u.a)(n);function n(){return Object(c.a)(this,n),e.apply(this,arguments)}return Object(o.a)(n,[{key:"render",value:function(){var t=this,e=this.props.classes;return Object(O.jsx)(Zt.a,{position:"relative",children:Object(O.jsxs)(te.a,{children:[Object(O.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[Object(O.jsx)(w.a,{variant:"h6",color:"inherit",noWrap:!0,children:this.props.title}),Object(O.jsx)(w.a,{variant:"caption",display:"block",noWrap:!0,children:this.props.subtitle})]}),this.props.items.map((function(t,n){var r=t.text,a=t.icon,i=t.action;return Object(O.jsx)(y.a,{color:"inherit",startIcon:a,className:e.sectionButton,onClick:function(t){t.preventDefault(),i()},children:r},n)})),this.props.rightMostItem?Object(O.jsx)(Jt.a,{flexGrow:1}):null,this.props.rightMostItem?Object(O.jsx)(y.a,{color:"inherit",onClick:function(e){e.preventDefault(),t.props.rightMostItem.action()},children:this.props.rightMostItem.text}):null]})})}}]),n}(a.a.Component),ne=Object(f.a)((function(t){return Object(d.a)({sectionButton:{marginLeft:t.spacing(2)}})}))(ee),re=function(t){Object(s.a)(n,t);var e=Object(u.a)(n);function n(){return Object(c.a)(this,n),e.apply(this,arguments)}return Object(o.a)(n,[{key:"render",value:function(){return Object(O.jsxs)(a.a.Fragment,{children:[Object(O.jsx)(ne,{title:this.props.title,subtitle:this.props.subtitle,items:this.props.items,rightMostItem:this.props.rightMostItem}),this.props.children]})}}]),n}(a.a.Component),ae=Object(j.a)({palette:{primary:{light:"#ff6434",main:"#dd2c00",dark:"#a30000",contrastText:"#ffffff"},secondary:{light:"#5e91f2",main:"#1564bf",dark:"#003b8e",contrastText:"#ffffff"}}}),ie=function(t){Object(s.a)(n,t);var e=Object(u.a)(n);function n(t){var r;return Object(c.a)(this,n),(r=e.call(this,t)).apiClient=void 0,r.apiClient=new xt,r.state={version:void 0},r}return Object(o.a)(n,[{key:"componentDidMount",value:function(){var t=this;this.apiClient.getVersion().then((function(e){return t.setState({version:e})})).catch((function(t){return console.error(t)}))}},{key:"render",value:function(){var t=this,e=this.props.classes;return Object(O.jsxs)(h.a,{theme:ae,children:[Object(O.jsx)(p.a,{}),Object(O.jsx)(re,{title:document.title,subtitle:"Katatachi v".concat(this.state.version||"..."),items:[{text:"Mod Views",icon:Object(O.jsx)(Et.a,{}),action:function(){t.props.history.push("/modViews/view")}},{text:"Workers",icon:Object(O.jsx)(At.a,{}),action:function(){t.props.history.push("/workers/view")}},{text:"Runs",icon:Object(O.jsx)(Bt.a,{}),action:function(){t.props.history.push("/workers/runs/view")}},{text:"Pipeline",icon:Object(O.jsx)(Pt.a,{}),action:function(){t.props.history.push("/pipeline/view")}}],rightMostItem:{text:"Logout",icon:null,action:function(){t.apiClient.unsetAuth(),window.location.reload()}},children:Object(O.jsx)(b.a,{children:Object(O.jsx)("main",{className:e.main,children:Object(O.jsxs)(l.d,{children:[Object(O.jsx)(l.a,{exact:!0,from:"/",to:"/modViews/view"}),Object(O.jsx)(l.b,{exact:!0,path:"/login",component:function(){return Object(O.jsx)(yt,{apiClient:t.apiClient})}}),Object(O.jsx)(v,{path:"/pipeline/view",apiClient:this.apiClient,render:function(){return Object(O.jsx)(Tt,{apiClient:t.apiClient})}}),Object(O.jsx)(v,{path:"/modViews/view",apiClient:this.apiClient,render:function(){return Object(O.jsx)($,{apiClient:t.apiClient})}}),Object(O.jsx)(l.b,{path:"/modView/:name",apiClient:this.apiClient,component:function(){return Object(O.jsx)(pt,{apiClient:t.apiClient})}}),Object(O.jsx)(l.b,{path:"/workers/view",apiClient:this.apiClient,component:function(){return Object(O.jsx)(B,{apiClient:t.apiClient})}}),Object(O.jsx)(l.b,{path:"/workers/create",apiClient:this.apiClient,component:function(){return Object(O.jsx)(Q,{apiClient:t.apiClient})}}),Object(O.jsx)(l.b,{path:"/worker/:workerId",apiClient:this.apiClient,component:function(){return Object(O.jsx)(ft,{apiClient:t.apiClient})}}),Object(O.jsx)(l.b,{path:"/workers/runs/view",apiClient:this.apiClient,component:function(){return Object(O.jsx)(Yt,{apiClient:t.apiClient})}})]})})})})]})}}]),n}(a.a.Component),ce=Object(l.h)(Object(f.a)((function(t){return Object(d.a)({main:{padding:t.spacing(4,0,3)}})}))(ie));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var oe=n(224),se=document.getElementById("root");Object(oe.createRoot)(se).render(Object(O.jsx)(i.a,{basename:"/web",children:Object(O.jsx)(ce,{})})),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(t){t.unregister()}))}},[[447,1,2]]]);
//# sourceMappingURL=main.7d1aac26.chunk.js.map